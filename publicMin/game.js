function makeNewPopperGame(t,e,i){function a(t,e,i){var a;return g.length>0?(a=g.pop(),a.t.forEachSet(function(){return 0}),a.x=t,a.y=e,a.h=i):a={x:t,y:e,t:new binaryData.Array(s,8,!1),h:i,v:0},f.push(a),a}function r(t){g.push(t)}function n(){l.forEach(function(t,e){if(t)for(var r=0,n=0;s>n;n++)if(o.get(e,n))r++;else if(r)for(var h=a(e,(n-r)*i,r),f=0;r>f;f++)h.t.set(f,o.get(e,n-r+f)),o.set(e,n-r+f,0)})}var h={grid:new binaryData.Grid(t,e,8,!1),size:i},o=h.grid,s=e;console.log(o);var f=[],g=[];h.chains=f,new binaryData.Grid(t,e,8,!1);var l=new binaryData.Array(t,16,!1);return h.grid.forEachSet(function(){return Math.floor(4*Math.random()+2)}),h.draw=function(){var t=this.size;this.grid.forEach(function(e,i,a){e>1&&ctx.drawImage(tiles[e],i*t*ratio,a*t*ratio,t*ratio,t*ratio)}),f.forEach(function(e){e.t.forEach(function(i,a){i>1&&ctx.drawImage(tiles[i],e.x*t*ratio,(a*t+e.y)*ratio)})})},h.update=function(t){for(var e=0;e<f.length;e++){var a=f[e];a.v=Math.min(.5*i,a.v+.03125*i*t),a.y+=.03125*a.v*t,(o.get(a.x,Math.floor((a.y+a.h*i)/i))||a.y+a.h*i>=s*i)&&(a.t.forEach(function(t,e,r){t&&(o.set(a.x,e+Math.floor(a.y/i),t),r.set(e,0))}),r(a),f.splice(e,1),e--)}},h.click=function(t,e){t=Math.floor(t/i),e=Math.floor(e/i),l.setAll(0);var a=o.get(t,e),r=0;propagate(o,t,e,function(t){return t==a},function(i,a){r++,2==r&&(o.set(t,e,0),l.set(t,l.get(t)+1)),r>=2&&(o.set(i,a,0),l.set(i,l.get(i)+1))}),n()},h.usedChains=g,h.chains=f,h}