function makeNewPopperGame(t,i,e){function h(t,i,e){var h;return g.length>0?(h=g.pop(),h.t.forEachSet(function(){return 0}),h.x=t,h.y=i,h.h=e):h={x:t,y:i,t:new binaryData.Array(f,8,!1),h:e,v:0},l.push(h),h}function r(t){g.push(t)}function a(){return Math.floor(4*Math.random()+2)}function n(){m.forEach(function(t,i){if(t)for(var r=0,n=0,o=0;f>o;o++)if(s.get(i,o))n++;else if(n||!r&&c){for(var l=!r&&c?t:0,g=h(i,(o-n-l)*e,n+l),u=0;l>u;u++)g.t.set(u,a());for(var u=0;n>u;u++)g.t.set(u+l,s.get(i,o-n+u)),s.set(i,o-n+u,0);r++}})}var o={grid:new binaryData.Grid(t,i,8,!1),size:e},s=o.grid,f=i;console.log(s);var l=[],g=[],c=!0;o.chains=l;var u=new binaryData.Grid(t,i,8,!1),m=new binaryData.Array(t,16,!1);return o.grid.forEachSet(function(){return Math.floor(4*Math.random()+2)}),o.draw=function(){var t=this.size;this.grid.forEach(function(i,e,h){i>1&&ctx.drawImage(tiles[i],e*t*ratio,h*t*ratio,t*ratio,t*ratio)}),l.forEach(function(i){i.t.forEach(function(e,h){e>1&&ctx.drawImage(tiles[e],i.x*t*ratio,(h*t+i.y)*ratio)})})},o.update=function(t){for(var i=0;i<l.length;i++){var h=l[i];h.v=Math.min(.5*e,h.v+.03125*e*t),h.y+=Math.min(.03125*h.v*t,.5*e),(s.get(h.x,Math.floor((h.y+h.h*e)/e))||h.y+h.h*e>=f*e)&&(h.t.forEach(function(t,i){t&&s.set(h.x,i+Math.floor(h.y/e),t)}),r(h),l.splice(i,1),i--)}},o.click=function(t,i){t=Math.floor(t/e),i=Math.floor(i/e),m.setAll(0);var h=s.get(t,i),r=0;u.setAll(0),propagate(s,t,i,function(t){return t==h},function(e,h){r++,2==r&&(s.set(t,i,0),m.set(t,m.get(t)+1)),r>=2&&(s.set(e,h,0),m.set(e,m.get(e)+1))},u),n()},o.usedChains=g,o.chains=l,o}