function makeNewPopperGame(t,i,e){function h(t,i,e){var h;return l.length>0?(h=l.pop(),h.t.forEachSet(function(){return 0}),h.x=t,h.y=i,h.h=e):h={x:t,y:i,t:new binaryData.Array(s,8,!1),h:e,v:0},f.push(h),h}function r(t){l.push(t)}function a(){g.forEach(function(t,i){if(t)for(var r=0,a=0;s>a;a++)if(o.get(i,a))r++;else if(r)for(var n=h(i,(a-r)*e,r),f=0;r>f;f++)n.t.set(f,o.get(i,a-r+f)),o.set(i,a-r+f,0)})}var n={grid:new binaryData.Grid(t,i,8,!1),size:e},o=n.grid,s=i;console.log(o);var f=[],l=[];n.chains=f,new binaryData.Grid(t,i,8,!1);var g=new binaryData.Array(t,16,!1);return n.grid.forEachSet(function(){return Math.floor(4*Math.random()+2)}),n.draw=function(){var t=this.size;this.grid.forEach(function(i,e,h){i>1&&ctx.drawImage(tiles[i],e*t*ratio,h*t*ratio,t*ratio,t*ratio)}),f.forEach(function(i){i.t.forEach(function(e,h){e>1&&ctx.drawImage(tiles[e],i.x*t*ratio,(h*t+i.y)*ratio)})})},n.update=function(t){for(var i=0;i<f.length;i++){var h=f[i];h.v=Math.min(.5*e,h.v+.03125*e*t),h.y+=.03125*h.v*t,(o.get(h.x,Math.floor((h.y+h.h*e)/e))||h.y+h.h*e>=s*e)&&(h.t.forEach(function(t,i,r){t&&(o.set(h.x,i+Math.floor(h.y/e),t),r.set(i,0))}),r(h),f.splice(i,1),i--)}},n.click=function(t,i){t=Math.floor(t/e),i=Math.floor(i/e),g.setAll(0);var h=o.get(t,i);propagate(o,t,i,function(t){return t==h},function(t,i){o.set(t,i,0),g.set(t,g.get(t)+1)}),a()},n.usedChains=l,n.chains=f,n}