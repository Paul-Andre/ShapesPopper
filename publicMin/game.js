function makeNewPopperGame(t,e,a){function i(t,e,a){var i;return m.length>0?(i=m.pop(),i.t.forEachSet(function(){return 0}),i.x=t,i.y=e,i.h=a):i={x:t,y:e,t:new binaryData.Array(g,8,!1),h:a,v:0},a>g&&(console.log(i),alert(a)),d[t].push(i),i}function r(t){m.push(t)}function n(){for(;x>w[b+1]&&b<w.length-1;)switch(b++,b){case 1:p=!1;break;case 2:for(var t=0;u>t;t++){var e=i(t,-a,1);e.t.set(0,6)}for(var t=0;20*u>t;t++){var r=Math.random()*u*a;c.makeParticle(r,0,100*Math.random()+10,100*Math.random()+10,1e3*Math.random()+1e3,50,"white",5,0)}break;case 3:p=!0,M=2,s();break;case 4:M=3;break;case 5:M=4;break;case 6:M=5;break;case 7:M=6;break;case 8:p=!1;break;case 9:for(var t=0;u>t;t++){var e=i(t,-a,1);e.t.set(0,h())}break;case 10:M=1;for(var t=0;u>t;t++)for(var e=i(t,-3*a,3),n=0;3>n;n++)e.t.set(n,h());break;case 11:p=!0;break;case 12:alert("you have won the game at it's current state!")}}function h(){return 1==M?rand(4)+2:2==M?[2,4,5,6][rand(4)]:3==M?[2,4,4,4,4,5,6,6,6,6,6,6][rand(12)]:4==M?[2,4,4,4,4,4,6,6,6,6,6,6][rand(12)]:5==M?[2,2,2,4,5,4,3,5,6,4,6,6][rand(12)]:6==M?[2,3,4,5,6][rand(5)]:7==M?[2,3,4,5,6][rand(5)]:void 0}function o(){D.forEach(function(t,e){if(t)for(var r=0,n=0,o=0;g>o;o++)if(l.get(e,o))n++;else if(n||!r&&p){for(var s=!r&&p?t:0,f=i(e,(o-n-s)*a,n+s),c=0;s>c;c++)f.t.set(c,h());for(var c=0;n>c;c++)f.t.set(c+s,l.get(e,o-n+c)),l.set(e,o-n+c,0);r++}})}function s(){D.setAll(0),l.forEach(function(t,e){0==t&&D.set(e,D.get(e)+1)}),d.forEach(function(t,e){t.forEach(function(t){D.set(e,Math.max(0,D.get(e)-t.h))})}),o()}var f={grid:new binaryData.Grid(t,e,8,!1),size:a,width:t,height:e,chains:[]},c=createParticleSystem();f.pS=c;var l=f.grid,u=t,g=e;console.log(l);for(var d=f.chains,v=0;u>v;v++)d.push([]);var m=[],M=1,b=0,y=[],w=y;w[1]=150,w[2]=w[1]+Math.floor(.4*u*g),w[3]=w[2]+Math.floor(.4*u*g)+u,w[4]=w[3]+Math.floor(.2*u*g),w[5]=w[4]+200,w[6]=w[5]+200,w[7]=w[6]+150,w[8]=w[7]+100,w[9]=w[8]+Math.floor(.3*u*g),w[10]=w[9]+Math.floor(.3*u*g),w[11]=w[10]+3*u,w[12]=w[11]+300;var p=!0,x=0;f.chains=d;var A=new binaryData.Grid(t,e,8,!1),D=new binaryData.Array(t,16,!1);return f.modifiedClumns=D,f.fill=s,setInterval(function(){p&&s()},1e3),f.grid.forEachSet(function(){return h()}),f.draw=function(){var t=this.size;this.grid.forEach(function(e,a,i){e>1&&ctx.drawImage(tiles[e],a*t*ratio,i*t*ratio,t*ratio,t*ratio)}),d.forEach(function(e){e.forEach(function(e){e.t.forEach(function(a,i){a>1&&ctx.drawImage(tiles[a],e.x*t*ratio,(i*t+e.y)*ratio)})})}),ctx.save(),ctx.scale(ratio,ratio),c.draw(ctx),ctx.restore()},f.update=function(t){d.forEach(function(e){for(var i=0;i<e.length;i++){var n=e[i];n.v=Math.min(.5*a,n.v+.03125*a*t),n.y+=Math.min(.03125*n.v*t,.5*a),(l.get(n.x,Math.floor((n.y+n.h*a)/a))||n.y+n.h*a>=g*a)&&(n.t.forEach(function(t,e){t&&l.set(n.x,e+Math.floor(n.y/a),t)}),r(n),e.splice(i,1),i--)}}),c.update(t)},f.click=function(t,e){if(t=Math.floor(t/a),e=Math.floor(e/a),u>t&&g>e){var i=l.get(t,e),r=0;A.setAll(0),i>1&&(propagate(l,t,e,function(t){return t==i},function(n,h){function o(t,e){l.set(t,e,0),x++,c.burst(t*a,e*a,40,a,2e3,particleColors[i])}r++,2==r&&o(t,e),r>=2&&o(n,h)},A),s())}n()},f.usedChains=m,f.chains=d,f}